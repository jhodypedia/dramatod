<div class="detail-info">
  <h1><%= chapters[0]?.bookName || '' %></h1>
  <p class="intro"><%= chapters[0]?.introduction || '' %></p>
  <div class="tags">
    <% (chapters[0]?.tags || []).forEach(tag => { %>
      <span class="tag"><%= tag %></span>
    <% }) %>
  </div>
  <div class="stats">
    <span><%= chapters[0]?.playCount || '0' %> views</span>
    <span>Rilis: <%= chapters[0]?.shelfTime || '' %></span>
  </div>
</div>

<h2 class="title">Daftar Episode</h2>
<div id="episode-list" class="episode-list"></div>
<button id="loadMore" class="btn">Load More</button>

<script>
  const chapters = <%- JSON.stringify(chapters) %>;
  let perPage = 20;
  let currentPage = 1;

  function renderEpisodes() {
    const container = document.getElementById("episode-list");
    container.innerHTML = "";
    const end = perPage * currentPage;
    const list = chapters.slice(0, end);
    list.forEach(ch => {
      const a = document.createElement("a");
      a.className = "episode";
      a.href = `/watch/<%= bookId %>/${ch.index}`;
      a.innerHTML = `
        <img src="/img?url=${encodeURIComponent(ch.cover || ch.coverImg || ch.hCover || ch.hSmallCover || ch.verticalCover || ch.coverWap || '')}" class="lazy blur"/>
        <div class="ep-meta">
          <span>Episode ${ch.index}</span>
          <span class="muted">${ch.chapterName || ''}</span>
        </div>
      `;
      container.appendChild(a);
    });
    if (end >= chapters.length) document.getElementById("loadMore").style.display = "none";
  }

  document.getElementById("loadMore").addEventListener("click", () => {
    currentPage++;
    renderEpisodes();
  });

  renderEpisodes();
</script>
